---
title: 设备树规范v0.2
tags: Linux内核
---

------

&emsp;&emsp;<font color=blue>**_版权声明_**</font>：本文翻译自<font color=blue>[设备树官网](https://www.devicetree.org/)。</font><font color=red>未经作者允许，<font color=blue>严禁用于商业出版</font>，否则追究法律责任。网络转载请注明出处，这是对原创者的起码的尊重！！！</font>

------

<style>table{word-break:initial;}</style>

### 3.7.1 /cpus/cpu\*节点的普通属性

下表描述了cpu节点的普通属性。 表3.6中描述的一些属性是具有特定适用细节的标准属性。

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 3.6  /cpus/cpu\*节点的普通属性

|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|device_type|R |\<string>|值必须为“cpu”。|
|reg |R |\<prop-encoded-array>|reg的值是\<prop-encoded-array>，它为CPU节点表示的CPU/线程定义了 唯一CPU/线程ID。<br /><br />如果CPU支持多个线程（即多个执行流），则reg属性是每线程1个元素的数组。 /cpus节点上的#address-cells指定数组中每个元素占用的单元格(cell)数。软件可以通过将reg的大小除以/cpus的#address-cells来确定线程数。<br /><br />如果CPU/线程可以作为外部中断的目标，则reg属性值必须是可由中断控制器寻址的唯一CPU/线程ID。<br /><br />如果CPU /线程不能成为外部中断的目标，则reg必须是唯一的并且超出中断控制器寻址的范围。<br /><br />如果CPU/线程的PIR（挂起中断寄存器）是可修改的，则客户程序应（should）修改PIR以匹配reg属性值。如果PIR不能修改并且PIR值与中断控制器编号空间不同，则CPU绑定可以根据需要定义绑定特定表示的PIR值。
|clock-frequency|R |\<prop-encoded-array>|以赫兹为单位指定CPU的当前时钟速度。 该值是两种形式之一的\<prop-encoded-array>：<br />&emsp;&emsp;•  一个\<u32>。<br />&emsp;&emsp;•  一个\<u64>
|timebase-frequency|R |array|指定更新时基（timebase register）寄存器和递减器寄存器（decrementer registers ）的当前频率（以赫兹为单位）。 该值是两种形式之一的\<prop-encoded-array>：<br />&emsp;&emsp;•  一个\<u32>。<br />&emsp;&emsp;•  一个\<u64>
|status| SD| \<string> |描述CPU状态的标准属性。 对于对称多处理（SMP）配置中的CPU的节点，此属性应存在。对于CPU节点，“okay”和“disabled”值的含义如下：<br />&emsp;&emsp;• “okay”：CPU正在运行。<br />&emsp;&emsp;• “disabled”：CPU处于静止状态。<br />静止CPU是一种状态，它不会干扰其他CPU正常操作，也不会被其它正在运行的CPU的正常操作影响，除非用显式方法 启用或重新启用静态CPU（请参阅 enable-method属性）。<br />特别的，正在运行的CPU应能够在不影响静态CPU的情况下发出广播TLB无效。<br />示例：静态CPU可以处于自旋循环中，保持在复位状态，并与系统总线或其他实现相关状态电隔离。
|enable-method|SD |\<stringlist>|描述启用disabled状态的CPU的方法。 具有值为“disabled”的status属性的CPU需要此属性。该值由一个或多个字符串组成，这些字符串定义释放此CPU的方法。 如果客户程序能识别任何一种方法，则可以使用它。值应为以下之一：<br />&emsp;&emsp;“spin-table”：使用DT-Spec中定义的自旋表（spin table）方法启用CPU。<br />&emsp;&emsp;"[vendor],[method]" :实现取决于描述CPU从“disabled”状态释放的方法的字符串。所需格式为：“[vendor]，[method]”，其中vendor是描述制造商名称的字符串，method是描述供应商特定机制的字符串。示例：“fsl，MPC8572DS”<br /><br />注意：其他方法可能会添加到DTSpec规范的后续版本中。
|cpu-release-addr|SD| \<u64>|enable-method属性的值为“spin-table”的cpu节点需要cpu-release-addr属性。该值指定从其自旋循环释放次级（secondary）CPU的自旋表条目的物理地址。



>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。




&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 3.7  /cpus/cpu\*节点的Power ISA 属性

|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|power-isa-version|O| \<string>|一个字符串，指定Power ISA版本字符串的数字部分。 例如，对于符合Power ISA版本2.06的实现，此属性的值将为“2.06”。
|power-isa-* |O |\<empty>|如果power-isa-version属性存在，则对于显示的Power ISA版本的Book I的Categories部分中的每个类别，存在名为power-isa-[CAT]的属性，其中[CAT]是将所有大写字母转换为小写的类别名缩写，表示该实现支持该类别。<br /> <br />例如，如果power-isa-version属性存在且其值为“2.06”且power-isa-e.hv属性存在，则该实现支持Power ISA版本2.06中定义的[Category:Embedded.Hypervisor]。
|cache-op-block-size|SD |\<u32>|指定高速缓存块指令操作的块大小（以字节为单位）（例如，dcbz）。 如果与L1高速缓存块大小不同，则为必需。
|reservation-granule-size|SD |\<u32>|指定此处理器支持的预留粒度大小（以字节为单位）。
|mmu-type |O |\<string> |指定cpu的MMU类型，合法的值如下： "mpc8xx"、"ppc40x"、 "ppc440"、 "ppc476"、 "power-embedded"、 "powerpc-classic"、 "power-server-stab"、 "power-server-slb"、 "none"


>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。

旧版本的设备树，可能会在cpu节点中遇到bus-frequency 属性。 为了兼容性，客户程序可能希望支持bus-frequency。 该值的格式与clock-frequency的格式相同。 建议的做法是使用clock-frequency属性表示总线节点上总线频率。


### 3.7.2 TLB属性
cpu节点的以下属性描述了处理器MMU中的转换后备（translate look-aside）缓冲区。


&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 3.8  /cpus/cpu\*节点的Power ISA TLB属性


|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|tlb-split| SD|\<empty>|如果该属性存在，则指定TLB具有分开的配置用于指令和数据的独立TLB。 如果不存在，则指定TLB具有统一配置。对于具有用于分离配置TLB的CPU，该属性是必需的|
|tlb-size| SD |\<u32>| 指定TLB中的条目数。 对于具有用于指令和数据地址的统一TLB的CPU，该属性是必需的。|
|tlb-sets |SD| 	\<u32>| 指定TLB中的关联集的数量。对于具有用于指令和数据地址的统一TLB的CPU，该属性是必需的。|
|d-tlb-size| SD |	\<u32> |指定数据TLB中的条目数。对于具有用于分离配置TLB的CPU，该属性是必需的
|d-tlb-sets |SD| 	\<u32>| 指定数据TLB中的关联集的数量。对于具有用于分离配置TLB的CPU，该属性是必需的|
|i-tlb-size| SD |	\<u32> |指定指令TLB中的条目数。对于具有用于分离配置TLB的CPU，该属性是必需的
|i-tlb-sets |SD| 	\<u32>| 指定指令TLB中的关联集的数量。对于具有用于分离配置TLB的CPU，该属性是必需的|

>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。

### 3.7.3 内存cache（L1）属性
cpu节点的以下属性描述了处理器的内部（L1）缓存。


&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 3.9  /cpus/cpu\*节点的Power ISA cache属性



|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|cache-unified| SD| \<empty>|如果存在该属性，则指定缓存具有统一的组织（unified organization）。 如果不存在，则指定缓存具有哈佛架构，哈佛架构具有用于指令和数据的单独缓存。|
|cache-size| SD| \<u32> |指定统一高速缓存的大小（以字节为单位）。如果缓存是统一的（组合指令和数据），则该属性必需。|
|cache-sets| SD |\<u32> |指定统一高速缓存中的关联集的数量。如果缓存是统一的（组合指令和数据），则该属性必需。|
|cache-block-size |SD |\<u32>|指定统一高速缓存的块大小（以字节为单位）。如果缓存是统一的（组合指令和数据），则该属性必需。|
|cache-line-size |SD |\<u32>|如果不同于高速缓存块大小，则指定统一高速缓存的行大小（以字节为单位）如果处理器具有统一缓存（组合指令和数据），则为必需。|
|i-cache-size| SD| \<u32> |指定指令缓存的大小（以字节为单位）。如果处理器具有独立的指令缓存，则为必需。|
|i-cache-sets| SD |\<u32> |指定指令缓存中的关联集的数量。如果处理器具有独立的指令缓存，则为必需。|
|i-cache-block-size |SD |\<u32>|指定指令缓存的块大小（以字节为单位）。如果处理器具有独立的指令缓存，则为必需。|
|i-cache-line-size |SD |\<u32>|如果不同于指令高速缓存块大小，则指定指令缓存的行大小（以字节为单位）。如果处理器具有独立的指令缓存，则为必需。|
|d-cache-size| SD| \<u32> |指定数据缓存的大小（以字节为单位）。如果处理器具有独立的数据缓存，则为必需。|
|d-cache-sets| SD |\<u32> |指定数据缓存中的关联集的数量。如果处理器具有独立的数据缓存，则为必需。|
|d-cache-block-size |SD |\<u32>|指定数据缓存的块大小（以字节为单位）。如果处理器具有独立的数据缓存，则为必需。|
|d-cache-line-size |SD |\<u32>|如果不同于数据高速缓存块大小，则指定数据缓存的行大小（以字节为单位）。如果处理器具有独立的数据缓存，则为必需。|
|next-level-cache |SD |\<phandle>|如果该属性存在，则表示存在另一级别的缓存。 该值是下一级缓存的phandle。 phandle值类型在2.3.3节中有详细描述。|

>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。


可能遇到旧版本的设备树，其中包含名为l2-cache的next-level-cache属性的弃用形式。 为了兼容性，如果不存在next-level-cache属性，则客户端程序可能希望支持l2-cache。 这两个属性的含义和用法是相同的。

### 3.7.4 示例

```dts
cpus {
	#address-cells = <1>;
	#size-cells = <0>;
	cpu@0 {
		device_type = "cpu";
		reg = <0>;
		d-cache-block-size = <32>; // L1 - 32 bytes
		i-cache-block-size = <32>; // L1 - 32 bytes
		d-cache-size = <0x8000>; // L1, 32K
		i-cache-size = <0x8000>; // L1, 32K
		timebase-frequency = <82500000>; // 82.5 MHz
		clock-frequency = <825000000>; // 825 MHz
	};
};
```



## 3.8 多级和共享缓存节点(/cpus/cpu * /l?-cache)

处理器和系统可以实现额外级别的缓存层次结构。 例如，第二级（L2）或第三级（L3）高速缓存。 这些高速缓存可以紧密集成到CPU中，也可以在多个CPU之间共享。

compatile值为“cache”的设备节点描述了这些类型的高速缓存。

缓存节点应定义一个phandle属性，并且关联和或共享这些缓存的所有cpu节点或缓存节点都应包含一个next-level-cache属性，该属性指定指向这些缓存节点的phandle。

缓存节点可以出现在CPU节点或设备树中的任何其他适当位置。

多级和共享高速缓存使用表3-9中的属性表示。 L1缓存的属性在表3-8中描述。


&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 3.10  /cpu/cpu\*/l?-cache节点Power ISA 多级和共享缓存节点属性


|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|compatible| R |\<string> |标准属性。 值应必须包括字符串“cache”。
|cache-level |R |\<u32> |指定缓存层次结构中的级别。 例如，L2级缓存的值为2。


>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。

### 3.8.1 示例
请参阅以下两个CPU的设备表示的示例，每个CPU都有自己的L2缓存和共享的L3缓存。
```dts
cpus {
	#address-cells = <1>;
	#size-cells = <0>;
	cpu@0 {
		device_type = "cpu";
		reg = <0>;
		cache-unified;
		cache-size = <0x8000>; // L1, 32KB
		cache-block-size = <32>;
		timebase-frequency = <82500000>; // 82.5 MHz
		next-level-cache = <&L2_0>; // phandle to L2
		L2_0:l2-cache {
			compatible = "cache";
			cache-unified;
			cache-size = <0x40000>; // 256 KB
			cache-sets = <1024>;
			cache-block-size = <32>;
			cache-level = <2>;
			next-level-cache = <&L3>; // phandle to L3
			L3:l3-cache {
				compatible = "cache";
				cache-unified;
				cache-size = <0x40000>; // 256 KB
				cache-sets = <0x400>; // 1024
				cache-block-size = <32>;
				cache-level = <3>;
			};
		};
	};
	cpu@1 {
		device_type = "cpu";
		reg = <1>;
		cache-unified;
		cache-block-size = <32>;
		cache-size = <0x8000>; // L1, 32KB
		timebase-frequency = <82500000>; // 82.5 MHz
		clock-frequency = <825000000>; // 825 MHz
		next-level-cache = <&L2_1>; // phandle to L2
		L2_1:l2-cache {
			compatible = "cache";
			cache-level = <2>;
			cache-unified;
			cache-size = <0x40000>; // 256 KB
			cache-sets = <0x400>; // 1024
			cache-line-size = <32>; // 32 bytes
			next-level-cache = <&L3>; // phandle to L3
		};
	};
};
```

# 4 设备绑定

本章包含在设备树中有关如何表示特定类型和类的设备的要求（称为绑定）。 设备节点的compatible属性描述节点需要遵守的特定绑定。

绑定可以定义为其他每个的扩展。 例如，可以将新的总线类型定义为简单总线绑定的扩展。 在这种情况下，compatible属性将包含几个标识每个绑定的字符串 —— 从最具体到最一般（参见第2.3.1节，compatible）。

## 4.1绑定指南

### 4.1.1通用原则

为设备创建新的设备树时，完全描述设备必要属性和值得绑定也应该创建。这组属性应充分描述以为设备驱动程序提供需要的设备属性。

一些推荐的做法包括：


1. 使用2.3.1节中描述的约定兼容字符串。
2. 使用适用于新设备的标准属性（在2.3和2.4节中定义）。 此用法通常至少包括reg和interrupt属性。
3. 如果新设备符合DTSpec定义的设备类，请使用第4节（设备绑定）中指定的约定。
4. 如果适用，使用4.1.2节中指定的各种属性约定。
5. 如果绑定需要新属性，则建议的属性名称格式为：“\<company>，\<property-name>“，其中\<company>是OUI或短的唯一字符串，比如股票代码，用于标识绑定的创建者。示例：“ibm，ppc-interrupt-server＃s”

### 4.1.2 杂项属性
本节定义了可能适用于许多类型和类的设备的有用属性列表。 在此定义为便于其名称和用法的标准化。

**clock-frequency 属性** 

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.1 clock-frequency属性

|属性名|值类型|描述|
|:--|:--|:--|
|clock-frequency|\<prop-encoded-array>|以Hz为单位指定时钟频率。 该值是以两种形式之一的<prop-encoded-array>：<br />(1)32位整数；(2)64位整数。

**reg-shift属性**

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.2 reg-shift属性

|属性名|值类型|描述|
|:--|:--|:--|
|reg-shift|\<u32>|reg-shift属性提供了一种机制来表示除了寄存器之间的字节数不同之外在大多数方面相同的设备。reg-shift属性以字节为单位指定离散设备寄存器彼此分开的距离。 使用以下公式计算各个寄存器位置：“register << reg-shift“。 如果未指定，则默认值为0。例如，在16540 UART寄存器位于地址0x0,0x4,0x8,0xC，0x10,0x14,0x18和0x1C的系统中，将使用reg-shift = <2>属性来指定寄存器位置。

**label属性**

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.3 label属性

|属性名|值类型|描述|
|:--|:--|:--|
|label|\<string>|label属性定义人类可读的描述设备的字符串。给定设备的绑定指定该设备的属性的确切含义。|

## 4.2 串口设备
### 4.2.1 串口类绑定
串行设备类包括各种类型的点对点串行线设备。 串行线路设备的示例包括8250 UART，16550 UART，HDLC 设备和BISYNC设备。在大多数情况下，与RS-232标准兼容的硬件适合串行设备类。

I^2^C和SPI（串行外设接口）设备不应表示为串行端口设备，因为它们具有自己的特定表示。

**clock-frequency属性**


&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.4 clock-frequency属性

|clock-frequency|\<u32>|指定波特率发生器输入时钟的频率（以赫兹为单位）。| clock-frequency = \<100000000>;


**current-speed属性** 

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.5 current-speed属性

|属性名|值类型|描述|示例|
|:--|:--|:--|:--|
|current-speed|\<u32>|说明以每秒位数指定串行设备的当前速度。 如果已初始化串行设备，则引导程序应设置此属性。|115,200 Baud: current-speed = <115200>;







### 4.2.2 NS16450/16550兼容UART

与National Semiconductor 16450/16550 UART（通用异步接收器发送器）兼容的串行设备应使用以下属性在设备中表示。

&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;表 4.6 ns16550 UART属性


|属性名|用法|值类型|定义|
|:--|:--|:--|:--|
|compatible |R |\<string list> |值必须包括“ns16550”|
|clock-frequency |R |\<u32> |指定波特率发生器输入时钟的频率（以Hz为单位）|
|current-speed| OR |\<u32> |指定当前串行设备速度，以每秒位数为单位
|reg |R |\<prop-encode-darray>|指定父总线地址空间内寄存器设备的物理地址
|interrupts |OR |\<prop-encoded-array>|指定此设备生成的中断。 interruptts属性的值由一个或多个中断说明符组成。 中断说明符的格式由节点中断父节点的绑定文档定义。
|reg-shift |O|\<u32> |reg-shift属性以字节为单位指定离散设备寄存器彼此分开的距离。 使用以下公式计算各个寄存器位置：“register << reg-shift“。 如果未指定，则默认值为0。
|virtual-reg |SD |\<u32> or \<u64> |见2.3.7节。 指定映射到reg属性中指定的第一个物理地址的有效地址。 如果此设备节点是系统的控制台，则此属性是必需的。

>用法图例：R =必需，O =可选，OR =可选但推荐，SD =请参阅定义

>2.3节中的所有其它标准属性都是允许的，但是可选的。

## 4.3 网络设备
网络设备是面向分组的通信设备。 该类中的设备假设实现七层OSI模型的数据链路层（第2层）并使用媒体访问控制（MAC）地址。 网络设备的示例包括以太网，FDDI，802.11和令牌环。

### 4.3.1 网络类设备绑定












------

&emsp;&emsp;<font color=blue>**_版权声明_**</font>：本文翻译自<font color=blue>[设备树官网](https://www.devicetree.org/)。</font><font color=red>未经作者允许，<font color=blue>严禁用于商业出版</font>，否则追究法律责任。网络转载请注明出处，这是对原创者的起码的尊重！！！</font>

------
